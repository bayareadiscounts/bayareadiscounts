<div class="mobile-filter-toggle" id="mobile-filter-toggle" role="button" tabindex="0" aria-expanded="false" aria-controls="mobile-filter-drawer" aria-label="Filters - Open filter drawer">
  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
    <line x1="4" y1="21" x2="4" y2="14"></line>
    <line x1="4" y1="10" x2="4" y2="3"></line>
    <line x1="12" y1="21" x2="12" y2="12"></line>
    <line x1="12" y1="8" x2="12" y2="3"></line>
    <line x1="20" y1="21" x2="20" y2="16"></line>
    <line x1="20" y1="12" x2="20" y2="3"></line>
    <line x1="1" y1="14" x2="7" y2="14"></line>
    <line x1="9" y1="8" x2="15" y2="8"></line>
    <line x1="17" y1="16" x2="23" y2="16"></line>
  </svg>
  <span>Filters</span>
  <span class="filter-count" id="active-filter-count" aria-live="polite"></span>
</div>

<!-- Styles moved to /assets/css/components.css -->

<script>
(function() {
  const toggle = document.getElementById('mobile-filter-toggle');
  const panel = document.querySelector('.search-panel');
  const filterCount = document.getElementById('active-filter-count');
  
  if (!toggle || !panel) return;
  
  // Create backdrop
  const backdrop = document.createElement('div');
  backdrop.className = 'mobile-filter-backdrop';
  document.body.appendChild(backdrop);
  
  // Create close button
  const closeBtn = document.createElement('button');
  closeBtn.className = 'mobile-drawer-close';
  closeBtn.type = 'button';
  closeBtn.textContent = 'Close Filters';
  panel.querySelector('.search-container').appendChild(closeBtn);
  
  // Open drawer function
  function openDrawer() {
    panel.classList.add('mobile-open');
    panel.id = panel.id || 'mobile-filter-drawer';
    toggle.setAttribute('aria-expanded', 'true');
    backdrop.classList.add('show');
    document.body.style.overflow = 'hidden';
    // Focus the first interactive element in the panel
    setTimeout(function() {
      const firstInput = panel.querySelector('input, button, select');
      if (firstInput) firstInput.focus();
    }, 100);
  }

  // Open drawer on click
  toggle.addEventListener('click', openDrawer);

  // Keyboard support for Enter and Space
  toggle.addEventListener('keydown', function(e) {
    if (e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      openDrawer();
    }
  });
  
  // Close drawer
  function closeDrawer() {
    panel.classList.remove('mobile-open');
    toggle.setAttribute('aria-expanded', 'false');
    backdrop.classList.remove('show');
    document.body.style.overflow = '';
  }
  
  closeBtn.addEventListener('click', closeDrawer);
  backdrop.addEventListener('click', closeDrawer);
  
  // Update active filter count
  function updateFilterCount() {
    const activeFilters = document.querySelectorAll('.filter-btn.active:not([data-value=""])');
    const searchInput = document.getElementById('search-input') || document.getElementById('search');
    const hasSearch = searchInput && searchInput.value.trim().length > 0;
    
    const count = activeFilters.length + (hasSearch ? 1 : 0);
    filterCount.textContent = count > 0 ? count : '';
  }
  
  // Listen for filter changes
  document.addEventListener('click', function(e) {
    if (e.target.classList.contains('filter-btn')) {
      setTimeout(updateFilterCount, 100);
    }
  });
  
  const searchInput = document.getElementById('search-input') || document.getElementById('search');
  if (searchInput) {
    searchInput.addEventListener('input', updateFilterCount);
  }
  
  // Initial count
  updateFilterCount();
})();
</script>
